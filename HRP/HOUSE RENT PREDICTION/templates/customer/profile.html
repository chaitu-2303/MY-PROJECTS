{% extends "base.html" %}
{% block title %}Edit Profile{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between">
                    <h4 class="mb-0" style="font-weight:700;">Edit Profile</h4>
                    <span class="badge bg-info" aria-label="{{ role|capitalize }}">{{ role|capitalize }}</span>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" aria-label="Edit Profile Form">
                        {{ form.hidden_tag() }}
                        <div class="row mb-3">
                            <div class="col-md-4 text-center">
                                <img src="{{ url_for('static', filename='profile_pics/' ~ profile_pic) }}" class="rounded-circle img-thumbnail mb-2" width="150" height="150" alt="Profile picture" aria-label="Profile picture">
                                <div class="mt-2">
                                    <label for="profile_pic" class="form-label" aria-label="Change profile picture" data-bs-toggle="tooltip" title="Upload a new profile picture">
                                        {{ form.profile_pic.label }}
                                    </label>
                                    {{ form.profile_pic(class="form-control", id="profile_pic") }}
                                </div>
                                <small class="text-muted d-block mt-1">Accepted formats: JPG, PNG. Max size: 10MB.</small>
                            </div>
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="name" class="form-label" aria-label="Full Name">{{ form.name.label }}</label>
                                    {{ form.name(class="form-control", id="name") }}
                                    <small id="nameHelp" class="form-text text-muted">Your full name as it will appear to others.</small>
                                </div>
                                <div class="mb-3">
                                    <label for="username" class="form-label" aria-label="Username">Username</label>
                                    {{ form.username(class="form-control", id="username") }}
                                    <small id="usernameHelp" class="form-text text-muted">Unique handle for your account.</small>
                                </div>
                                <div class="mb-3">
                                    <label for="bio" class="form-label" aria-label="Bio">Bio</label>
                                    {{ form.bio(class="form-control", id="bio") }}
                                    <small id="bioHelp" class="form-text text-muted">A short description about yourself.</small>
                                </div>
                                <div class="mb-3">
                                    <label for="email" class="form-label" aria-label="Email Address">{{ form.email.label }}</label>
                                    {{ form.email(class="form-control", id="email") }}
                                    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                                </div>
                                <div class="mb-3">
                                    <label for="phone" class="form-label" aria-label="Phone Number">{{ form.phone.label }}</label>
                                    {{ form.phone(class="form-control", id="phone") }}
                                    <small id="phoneHelp" class="form-text text-muted">Enter a valid phone number.</small>
                                </div>
                                <div class="mb-3">
                                    <label for="dob" class="form-label" aria-label="Date of Birth">{{ form.dob.label }}</label>
                                    {{ form.dob(class="form-control", id="dob") }}
                                </div>
                                <div class="mb-3">
                                    <label for="location" class="form-label" aria-label="Location">Location</label>
                                    {{ form.location(class="form-control", id="location") }}
                                </div>
                                <div class="mb-3">
                                    <label for="timezone" class="form-label" aria-label="Time Zone">Time Zone</label>
                                    {{ form.timezone(class="form-control", id="timezone") }}
                                </div>
                                <div class="mb-3 form-check">
                                    {{ form.verified(class="form-check-input", id="verified") }}
                                    <label class="form-check-label" for="verified" aria-label="Verified">{{ form.verified.label }}</label>
                                </div>
                                <div class="mb-3">
                                    <span class="fw-bold">Member Since:</span> {{ member_since.strftime('%B %d, %Y') if member_since else 'N/A' }}
                                </div>
                                <div class="mb-3">
                                    <span class="fw-bold">Role:</span> {{ role|capitalize }}
                                </div>
                                <div class="mb-3">
                                    <span class="fw-bold">Two-Factor Authentication:</span>
                                    {% if two_factor_enabled %}
                                        <span class="badge bg-success">Enabled</span>
                                    {% else %}
                                        <span class="badge bg-danger">Disabled</span>
                                    {% endif %}
                                    <!-- Add toggle button for 2FA here if implemented -->
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary px-4" aria-label="Update Profile">Update Profile</button>
                        <span class="ms-3" id="formFeedback" aria-live="polite"></span>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h4 class="mb-0">Account Settings</h4>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{{ url_for('change_password') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" aria-label="Change Password">
                            Change Password
                            <i class="fas fa-key" aria-hidden="true"></i>
                        </a>
                        {% if role == 'customer' %}
                        <a href="{{ url_for('customer_favorites') }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" aria-label="My Favorites">
                            My Favorites
                            <i class="fas fa-heart" aria-hidden="true"></i>
                        </a>
                        {% endif %}
                        <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center text-danger" aria-label="Delete Account">
                            Delete Account
                            <i class="fas fa-trash" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    // Enable Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
{% endblock %}