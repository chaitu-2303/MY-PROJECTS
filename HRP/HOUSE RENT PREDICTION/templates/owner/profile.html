{% extends 'base.html' %}

{% block title %}Owner Profile - House Rent Prediction{% endblock %}

{% block extra_css %}
<style>
    .profile-header {
        background-color: var(--bs-primary);
        background-image: linear-gradient(135deg, var(--bs-primary) 0%, #4e73df 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
    }
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 5px solid rgba(255, 255, 255, 0.3);
        object-fit: cover;
    }
    .profile-stats {
        background-color: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
    }
    .profile-stat-item {
        text-align: center;
        padding: 15px 10px;
        border-right: 1px solid #eee;
    }
    .profile-stat-item:last-child {
        border-right: none;
    }
    .profile-stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--bs-primary);
        margin-bottom: 5px;
    }
    .profile-stat-label {
        font-size: 14px;
        color: #6c757d;
    }
    .profile-card {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
        overflow: hidden;
    }
    .profile-card-header {
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .profile-card-body {
        padding: 20px;
    }
    .profile-nav .nav-link {
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 10px;
        color: #495057;
        font-weight: 500;
        display: flex;
        align-items: center;
    }
    .profile-nav .nav-link i {
        margin-right: 10px;
        font-size: 18px;
    }
    .profile-nav .nav-link.active {
        background-color: var(--bs-primary);
        color: white;
    }
    .profile-nav .nav-link:hover:not(.active) {
        background-color: #f8f9fa;
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<header class="page-header bg-gradient-primary text-white py-5 mb-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="fw-bold" data-aos="fade-right">My Profile</h1>
                <nav aria-label="breadcrumb" data-aos="fade-right" data-aos-delay="100">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{{ url_for('home') }}" class="text-white">Home</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('owner.dashboard') }}" class="text-white">Dashboard</a></li>
                        <li class="breadcrumb-item active text-white" aria-current="page">Profile</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</header>

<!-- Profile Content -->
<section class="profile-content py-5">
    <div class="container">
        <div class="row">
            <!-- Profile Sidebar -->
            <div class="col-lg-3 mb-4">
                <div class="profile-card text-center mb-4" data-aos="fade-up">
                    <div class="profile-card-body pt-4 pb-3">
                        <img src="{{ url_for('static', filename='img/user-profile.jpg') }}" alt="Profile Picture" class="profile-avatar mb-3">
                        <h5 class="mb-1">{{ current_user.name }}</h5>
                        <p class="text-muted mb-3">Property Owner</p>
                        <div class="d-grid gap-2">
                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changePhotoModal">
                                <i class="fas fa-camera me-2"></i>Change Photo
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="profile-nav" data-aos="fade-up" data-aos-delay="100">
                    <div class="list-group">
                        <a href="{{ url_for('owner.dashboard') }}" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="{{ url_for('owner.profile') }}" class="nav-link active">
                            <i class="fas fa-user"></i> My Profile
                        </a>
                        <a href="{{ url_for('owner.add_property') }}" class="nav-link">
                            <i class="fas fa-plus-circle"></i> Add Property
                        </a>
                        <a href="#" class="nav-link">
                            <i class="fas fa-bell"></i> Notifications
                            <span class="badge bg-danger rounded-pill ms-auto">3</span>
                        </a>
                        <a href="#" class="nav-link">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <a href="{{ url_for('logout') }}" class="nav-link text-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Profile Content -->
            <div class="col-lg-9">
                <!-- Profile Stats -->
                <div class="profile-stats mb-4" data-aos="fade-up">
                    <div class="row g-0">
                        <div class="col-md-3">
                            <div class="profile-stat-item">
                                <div class="profile-stat-value">{{ properties|length if properties else 0 }}</div>
                                <div class="profile-stat-label">Properties</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="profile-stat-item">
                                <div class="profile-stat-value">{{ bookings|length if bookings else 0 }}</div>
                                <div class="profile-stat-label">Bookings</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="profile-stat-item">
                                <div class="profile-stat-value">4.8</div>
                                <div class="profile-stat-label">Rating</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="profile-stat-item">
                                <div class="profile-stat-value">â‚¹{{ total_earnings if total_earnings else 0 }}</div>
                                <div class="profile-stat-label">Earnings</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Personal Information -->
                <div class="profile-card mb-4" data-aos="fade-up">
                    <div class="profile-card-header">
                        <h5 class="mb-0">Personal Information</h5>
                        <button class="btn btn-sm btn-outline-primary" id="editPersonalInfoBtn">
                            <i class="fas fa-edit me-2"></i>Edit
                        </button>
                    </div>
                    <div class="profile-card-body">
                        <form id="personalInfoForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="fullName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="fullName" value="{{ current_user.name }}" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="email" value="{{ current_user.email }}" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" value="{{ current_user.phone }}" disabled>
                                </div>
                                <div class="col-md-6">
                                    <label for="dateJoined" class="form-label">Date Joined</label>
                                    <input type="text" class="form-control" id="dateJoined" value="{{ current_user.created_at.strftime('%d %b, %Y') if current_user.created_at else '01 Jan, 2023' }}" disabled>
                                </div>
                                <div class="col-12 mt-3 text-end" id="savePersonalInfoBtnContainer" style="display: none;">
                                    <button type="button" class="btn btn-secondary me-2" id="cancelPersonalInfoBtn">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="savePersonalInfoBtn">Save Changes</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Address Information -->
                <div class="profile-card mb-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="profile-card-header">
                        <h5 class="mb-0">Address Information</h5>
                        <button class="btn btn-sm btn-outline-primary" id="editAddressBtn">
                            <i class="fas fa-edit me-2"></i>Edit
                        </button>
                    </div>
                    <div class="profile-card-body">
                        <form id="addressForm">
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <label for="addressLine1" class="form-label">Address Line 1</label>
                                    <input type="text" class="form-control" id="addressLine1" value="123 Main Street" disabled>
                                </div>
                                <div class="col-md-12">
                                    <label for="addressLine2" class="form-label">Address Line 2</label>
                                    <input type="text" class="form-control" id="addressLine2" value="Apartment 4B" disabled>
                                </div>
                                <div class="col-md-4">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" value="Kolkata" disabled>
                                </div>
                                <div class="col-md-4">
                                    <label for="state" class="form-label">State</label>
                                    <input type="text" class="form-control" id="state" value="West Bengal" disabled>
                                </div>
                                <div class="col-md-4">
                                    <label for="zipCode" class="form-label">Zip Code</label>
                                    <input type="text" class="form-control" id="zipCode" value="700001" disabled>
                                </div>
                                <div class="col-12 mt-3 text-end" id="saveAddressBtnContainer" style="display: none;">
                                    <button type="button" class="btn btn-secondary me-2" id="cancelAddressBtn">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="saveAddressBtn">Save Changes</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Password Change -->
                <div class="profile-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="profile-card-header">
                        <h5 class="mb-0">Change Password</h5>
                    </div>
                    <div class="profile-card-body">
                        <form id="passwordForm">
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <label for="currentPassword" class="form-label">Current Password</label>
                                    <input type="password" class="form-control" id="currentPassword">
                                </div>
                                <div class="col-md-6">
                                    <label for="newPassword" class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="newPassword">
                                </div>
                                <div class="col-md-6">
                                    <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                    <input type="password" class="form-control" id="confirmPassword">
                                </div>
                                <div class="col-12 mt-3 text-end">
                                    <button type="submit" class="btn btn-primary">Update Password</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Change Photo Modal -->
<div class="modal fade" id="changePhotoModal" tabindex="-1" aria-labelledby="changePhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePhotoModalLabel">Change Profile Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="uploadPhotoForm">
                    <div class="mb-3">
                        <label for="profilePhoto" class="form-label">Upload New Photo</label>
                        <input class="form-control" type="file" id="profilePhoto" accept="image/*">
                    </div>
                    <div class="text-center mb-3">
                        <p class="text-muted">Or choose from our avatars</p>
                        <div class="row g-2">
                            <div class="col-3">
                                <img src="{{ url_for('static', filename='img/avatar-1.jpg') }}" class="img-thumbnail avatar-option" alt="Avatar 1">
                            </div>
                            <div class="col-3">
                                <img src="{{ url_for('static', filename='img/avatar-2.jpg') }}" class="img-thumbnail avatar-option" alt="Avatar 2">
                            </div>
                            <div class="col-3">
                                <img src="{{ url_for('static', filename='img/avatar-3.jpg') }}" class="img-thumbnail avatar-option" alt="Avatar 3">
                            </div>
                            <div class="col-3">
                                <img src="{{ url_for('static', filename='img/avatar-4.jpg') }}" class="img-thumbnail avatar-option" alt="Avatar 4">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Personal Information Edit Toggle
        const editPersonalInfoBtn = document.getElementById('editPersonalInfoBtn');
        const savePersonalInfoBtnContainer = document.getElementById('savePersonalInfoBtnContainer');
        const cancelPersonalInfoBtn = document.getElementById('cancelPersonalInfoBtn');
        const personalInfoInputs = document.querySelectorAll('#personalInfoForm input:not(#dateJoined)');
        
        editPersonalInfoBtn.addEventListener('click', function() {
            personalInfoInputs.forEach(input => {
                input.disabled = false;
            });
            savePersonalInfoBtnContainer.style.display = 'block';
            editPersonalInfoBtn.style.display = 'none';
        });
        
        cancelPersonalInfoBtn.addEventListener('click', function() {
            personalInfoInputs.forEach(input => {
                input.disabled = true;
            });
            savePersonalInfoBtnContainer.style.display = 'none';
            editPersonalInfoBtn.style.display = 'inline-block';
        });
        
        // Address Information Edit Toggle
        const editAddressBtn = document.getElementById('editAddressBtn');
        const saveAddressBtnContainer = document.getElementById('saveAddressBtnContainer');
        const cancelAddressBtn = document.getElementById('cancelAddressBtn');
        const addressInputs = document.querySelectorAll('#addressForm input');
        
        editAddressBtn.addEventListener('click', function() {
            addressInputs.forEach(input => {
                input.disabled = false;
            });
            saveAddressBtnContainer.style.display = 'block';
            editAddressBtn.style.display = 'none';
        });
        
        cancelAddressBtn.addEventListener('click', function() {
            addressInputs.forEach(input => {
                input.disabled = true;
            });
            saveAddressBtnContainer.style.display = 'none';
            editAddressBtn.style.display = 'inline-block';
        });
        
        // Form Submissions
        document.getElementById('personalInfoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Here you would normally send the data to the server
            // For now, we'll just simulate a successful update
            personalInfoInputs.forEach(input => {
                input.disabled = true;
            });
            savePersonalInfoBtnContainer.style.display = 'none';
            editPersonalInfoBtn.style.display = 'inline-block';
            
            // Show success message
            showAlert('Personal information updated successfully!', 'success');
        });
        
        document.getElementById('addressForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Here you would normally send the data to the server
            // For now, we'll just simulate a successful update
            addressInputs.forEach(input => {
                input.disabled = true;
            });
            saveAddressBtnContainer.style.display = 'none';
            editAddressBtn.style.display = 'inline-block';
            
            // Show success message
            showAlert('Address information updated successfully!', 'success');
        });
        
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Here you would normally validate and send the data to the server
            // For now, we'll just simulate a successful update
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // Show success message
            showAlert('Password updated successfully!', 'success');
        });
        
        // Helper function to show alerts
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.role = 'alert';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            // Insert at the top of the profile content
            const profileContent = document.querySelector('.profile-content .container');
            profileContent.insertBefore(alertDiv, profileContent.firstChild);
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                alertDiv.classList.remove('show');
                setTimeout(() => alertDiv.remove(), 150);
            }, 5000);
        }
        
        // Avatar selection in modal
        const avatarOptions = document.querySelectorAll('.avatar-option');
        avatarOptions.forEach(avatar => {
            avatar.addEventListener('click', function() {
                avatarOptions.forEach(a => a.classList.remove('selected'));
                this.classList.add('selected');
                this.style.border = '3px solid var(--bs-primary)';
            });
        });
    });
</script>
{% endblock %}
