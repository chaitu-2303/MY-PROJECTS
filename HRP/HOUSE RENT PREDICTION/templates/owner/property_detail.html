{% extends "base.html" %}

{% block title %}Property Details - Owner Dashboard{% endblock %}

{% block extra_css %}
<style>
    /* Property Detail Styles */
    .property-header {
        margin-bottom: 2rem;
    }
    
    .property-title {
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .property-location {
        color: var(--bs-gray-600);
        margin-bottom: 1rem;
    }
    
    .property-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--bs-primary);
    }
    
    .property-status {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .status-active {
        background-color: rgba(25, 135, 84, 0.1);
        color: var(--bs-success);
    }
    
    .status-pending {
        background-color: rgba(255, 193, 7, 0.1);
        color: var(--bs-warning);
    }
    
    .status-inactive {
        background-color: rgba(220, 53, 69, 0.1);
        color: var(--bs-danger);
    }
    
    .property-image {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .property-details-card {
        border-radius: 10px;
        border: none;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        margin-bottom: 1.5rem;
    }
    
    .property-details-card .card-header {
        background-color: transparent;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        padding: 1rem 1.5rem;
    }
    
    .property-details-card .card-body {
        padding: 1.5rem;
    }
    
    .amenity-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
    }
    
    .amenity-icon {
        width: 32px;
        height: 32px;
        background-color: rgba(var(--bs-primary-rgb), 0.1);
        color: var(--bs-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.75rem;
    }
    
    .property-stats {
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 1.5rem;
    }
    
    .property-stat-item {
        flex: 1 0 33.333%;
        text-align: center;
        padding: 1rem;
        border-right: 1px solid rgba(0,0,0,0.05);
    }
    
    .property-stat-item:last-child {
        border-right: none;
    }
    
    .property-stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--bs-primary);
        margin-bottom: 0.25rem;
    }
    
    .property-stat-label {
        font-size: 0.875rem;
        color: var(--bs-gray-600);
    }
    
    .action-buttons .btn {
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<header class="page-header bg-gradient-primary text-white py-5 mb-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="fw-bold" data-aos="fade-right">Property Details</h1>
                <nav aria-label="breadcrumb" data-aos="fade-right" data-aos-delay="100">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{{ url_for('home') }}" class="text-white">Home</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('owner.dashboard') }}" class="text-white">Dashboard</a></li>
                        <li class="breadcrumb-item active text-white" aria-current="page">Property Details</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</header>

<!-- Property Details Section -->
<section class="property-details py-5">
    <div class="container">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Property Header -->
                <div class="property-header" data-aos="fade-up">
                    <h2 class="property-title">{{ property.title }}</h2>
                    <p class="property-location"><i class="fas fa-map-marker-alt me-2"></i>{{ property.location }}</p>
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="property-price">₹{{ property.price }}/month</div>
                        <div class="property-status status-{{ property.status|lower }}">{{ property.status }}</div>
                    </div>
                </div>
                
                <!-- Property Image -->
                <div class="property-image mb-4" data-aos="fade-up">
                    <img src="{{ url_for('static', filename='img/properties/' + property.image) }}" class="img-fluid w-100" alt="{{ property.title }}">
                </div>
                
                <!-- Property Stats -->
                <div class="property-details-card mb-4" data-aos="fade-up">
                    <div class="property-stats">
                        <div class="property-stat-item">
                            <div class="property-stat-value">{{ property.bedrooms }}</div>
                            <div class="property-stat-label">Bedrooms</div>
                        </div>
                        <div class="property-stat-item">
                            <div class="property-stat-value">{{ property.bathrooms }}</div>
                            <div class="property-stat-label">Bathrooms</div>
                        </div>
                        <div class="property-stat-item">
                            <div class="property-stat-value">{{ property.area }}</div>
                            <div class="property-stat-label">Sq.Ft.</div>
                        </div>
                    </div>
                </div>
                
                <!-- Description -->
                <div class="property-details-card mb-4" data-aos="fade-up">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Description</h5>
                    </div>
                    <div class="card-body">
                        <p>{{ property.description }}</p>
                    </div>
                </div>
                
                <!-- Amenities -->
                <div class="property-details-card mb-4" data-aos="fade-up">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Amenities</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for amenity in property.amenities %}
                            <div class="col-md-6">
                                <div class="amenity-item">
                                    <div class="amenity-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div>{{ amenity }}</div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Location -->
                <div class="property-details-card mb-4" data-aos="fade-up">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Location</h5>
                    </div>
                    <div class="card-body">
                        <div id="propertyMap" style="height: 300px; border-radius: 10px;"></div>
                    </div>
                </div>
                
                <!-- Bookings -->
                <div class="property-details-card" data-aos="fade-up">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Recent Bookings</h5>
                        <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                    <div class="card-body">
                        {% if property.bookings %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead>
                                    <tr>
                                        <th>Tenant</th>
                                        <th>Date</th>
                                        <th>Duration</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for booking in property.bookings %}
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="{{ url_for('static', filename='img/user-profile.jpg') }}" class="rounded-circle me-2" width="32" height="32" alt="">
                                                <div>{{ booking.tenant_name }}</div>
                                            </div>
                                        </td>
                                        <td>{{ booking.date }}</td>
                                        <td>{{ booking.duration }}</td>
                                        <td>₹{{ booking.amount }}</td>
                                        <td>
                                            <span class="badge bg-{{ booking.status_color }}">{{ booking.status }}</span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <div class="mb-3">
                                <i class="fas fa-calendar-times fa-3x text-muted"></i>
                            </div>
                            <h6>No Bookings Yet</h6>
                            <p class="text-muted">Your property hasn't received any bookings yet.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Action Card -->
                <div class="property-details-card mb-4" data-aos="fade-up">
                    <div class="card-header">
                        <h5 class="mb-0">Manage Property</h5>
                    </div>
                    <div class="card-body">
                        <div class="action-buttons d-grid gap-2">
                            <a href="{{ url_for('owner.edit_property', property_id=property.id) }}" class="btn btn-primary">
                                <i class="fas fa-edit me-2"></i>Edit Property
                            </a>
                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#uploadPhotosModal">
                                <i class="fas fa-images me-2"></i>Manage Photos
                            </button>
                            <button type="button" class="btn btn-outline-primary">
                                <i class="fas fa-chart-line me-2"></i>View Analytics
                            </button>
                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deletePropertyModal">
                                <i class="fas fa-trash-alt me-2"></i>Delete Property
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Property Status Card -->
                <div class="property-details-card mb-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Property Status</h5>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="propertyStatusToggle" {% if property.status == 'Active' %}checked{% endif %}>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Current Status</label>
                            <div class="property-status status-{{ property.status|lower }} w-100 text-center py-2">{{ property.status }}</div>
                        </div>
                        <div class="mb-3">
                            <label for="propertyVisibility" class="form-label">Visibility</label>
                            <select class="form-select" id="propertyVisibility">
                                <option value="public" {% if property.visibility == 'public' %}selected{% endif %}>Public - Visible to everyone</option>
                                <option value="private" {% if property.visibility == 'private' %}selected{% endif %}>Private - Visible only to you</option>
                            </select>
                        </div>
                        <div class="mb-0">
                            <label for="featuredProperty" class="form-label">Featured Property</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="featuredProperty" {% if property.is_featured %}checked{% endif %}>
                                <label class="form-check-label" for="featuredProperty">Mark as featured</label>
                            </div>
                            <small class="text-muted">Featured properties appear at the top of search results</small>
                        </div>
                    </div>
                </div>
                
                <!-- Property Stats Card -->
                <div class="property-details-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <h5 class="mb-0">Property Stats</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Views</span>
                                <span class="fw-bold">{{ property.stats.views }}</span>
                            </div>
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar" role="progressbar" style="width: {{ property.stats.views_percentage }}%;" aria-valuenow="{{ property.stats.views_percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Inquiries</span>
                                <span class="fw-bold">{{ property.stats.inquiries }}</span>
                            </div>
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar" role="progressbar" style="width: {{ property.stats.inquiries_percentage }}%;" aria-valuenow="{{ property.stats.inquiries_percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Bookings</span>
                                <span class="fw-bold">{{ property.stats.bookings }}</span>
                            </div>
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar" role="progressbar" style="width: {{ property.stats.bookings_percentage }}%;" aria-valuenow="{{ property.stats.bookings_percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <a href="#" class="btn btn-sm btn-outline-primary">View Detailed Analytics</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Delete Property Modal -->
<div class="modal fade" id="deletePropertyModal" tabindex="-1" aria-labelledby="deletePropertyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deletePropertyModalLabel">Delete Property</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="fas fa-exclamation-triangle text-warning fa-3x mb-3"></i>
                    <h5>Are you sure you want to delete this property?</h5>
                    <p class="text-muted">This action cannot be undone. All data associated with this property will be permanently removed.</p>
                </div>
                <form id="deletePropertyForm">
                    <div class="mb-3">
                        <label for="deleteConfirmation" class="form-label">Type "DELETE" to confirm</label>
                        <input type="text" class="form-control" id="deleteConfirmation" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>Delete Property</button>
            </div>
        </div>
    </div>
</div>

<!-- Upload Photos Modal -->
<div class="modal fade" id="uploadPhotosModal" tabindex="-1" aria-labelledby="uploadPhotosModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadPhotosModalLabel">Manage Property Photos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <h6>Current Photos</h6>
                    <div class="row g-3">
                        {% for photo in property.photos %}
                        <div class="col-md-4 col-6">
                            <div class="position-relative">
                                <img src="{{ url_for('static', filename='img/properties/' + photo) }}" class="img-thumbnail" alt="Property Photo">
                                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2 rounded-circle" style="width: 30px; height: 30px; padding: 0;">
                                    <i class="fas fa-times"></i>
                                </button>
                                {% if loop.index == 1 %}
                                <span class="badge bg-primary position-absolute bottom-0 start-0 m-2">Main Photo</span>
                                {% else %}
                                <button type="button" class="btn btn-sm btn-light position-absolute bottom-0 start-0 m-2">
                                    <i class="fas fa-star me-1"></i>Set as Main
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div>
                    <h6>Upload New Photos</h6>
                    <form id="uploadPhotosForm">
                        <div class="mb-3">
                            <label for="propertyPhotos" class="form-label">Select Photos</label>
                            <input class="form-control" type="file" id="propertyPhotos" multiple accept="image/*">
                            <div class="form-text">You can upload up to 10 photos. Each photo should be less than 5MB.</div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Property Status Toggle
        const propertyStatusToggle = document.getElementById('propertyStatusToggle');
        if (propertyStatusToggle) {
            propertyStatusToggle.addEventListener('change', function() {
                const status = this.checked ? 'Active' : 'Inactive';
                // Here you would normally send an AJAX request to update the status
                console.log('Property status changed to:', status);
                
                // Update the status display
                const statusElement = document.querySelector('.property-status');
                statusElement.textContent = status;
                statusElement.className = 'property-status w-100 text-center py-2';
                statusElement.classList.add('status-' + status.toLowerCase());
                
                // Show success message
                showAlert('Property status updated successfully!', 'success');
            });
        }
        
        // Property Visibility Change
        const propertyVisibility = document.getElementById('propertyVisibility');
        if (propertyVisibility) {
            propertyVisibility.addEventListener('change', function() {
                // Here you would normally send an AJAX request to update the visibility
                console.log('Property visibility changed to:', this.value);
                
                // Show success message
                showAlert('Property visibility updated successfully!', 'success');
            });
        }
        
        // Featured Property Toggle
        const featuredProperty = document.getElementById('featuredProperty');
        if (featuredProperty) {
            featuredProperty.addEventListener('change', function() {
                // Here you would normally send an AJAX request to update the featured status
                console.log('Property featured status changed to:', this.checked);
                
                // Show success message
                showAlert('Property featured status updated successfully!', 'success');
            });
        }
        
        // Delete Property Confirmation
        const deleteConfirmation = document.getElementById('deleteConfirmation');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        if (deleteConfirmation && confirmDeleteBtn) {
            deleteConfirmation.addEventListener('input', function() {
                confirmDeleteBtn.disabled = this.value !== 'DELETE';
            });
            
            confirmDeleteBtn.addEventListener('click', function() {
                if (deleteConfirmation.value === 'DELETE') {
                    // Here you would normally send an AJAX request to delete the property
                    console.log('Property deleted');
                    
                    // Redirect to dashboard
                    window.location.href = "{{ url_for('owner.dashboard') }}";
                }
            });
        }
        
        // Initialize Google Map (if available)
        if (document.getElementById('propertyMap')) {
            // This is a placeholder for Google Maps initialization
            // In a real application, you would use the Google Maps API
            console.log('Map would be initialized here');
        }
        
        // Helper function to show alerts
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.role = 'alert';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            // Insert at the top of the property details section
            const propertyDetails = document.querySelector('.property-details .container');
            propertyDetails.insertBefore(alertDiv, propertyDetails.firstChild);
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                alertDiv.classList.remove('show');
                setTimeout(() => alertDiv.remove(), 150);
            }, 5000);
        }
    });
</script>
{% endblock %}
