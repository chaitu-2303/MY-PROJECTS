{% extends "base.html" %}

{% block title %}Add Property{% endblock %}

{% block extra_css %}
<style>
    /* Property Form Styles */
    .property-form-card {
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        border: none;
    }
    
    .property-form-card .card-header {
        background-color: transparent;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 20px 25px;
    }
    
    .property-form-card .card-body {
        padding: 25px;
    }
    
    .form-section {
        margin-bottom: 30px;
        padding-bottom: 30px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .form-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }
    
    .form-section-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #333;
    }
    
    .amenity-checkbox {
        margin-bottom: 10px;
    }
    
    .image-preview-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
    }
    
    .image-preview-item {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 10px;
        overflow: hidden;
        border: 2px dashed #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .image-preview-item .remove-image {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 12px;
        color: #dc3545;
    }
    
    .add-image-btn {
        width: 100px;
        height: 100px;
        border-radius: 10px;
        border: 2px dashed #ddd;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #6c757d;
        transition: all 0.2s;
    }
    
    .add-image-btn:hover {
        border-color: #6c757d;
        color: #495057;
    }
    
    .add-image-btn i {
        font-size: 24px;
        margin-bottom: 5px;
    }
    
    .add-image-btn span {
        font-size: 12px;
    }
    
    .location-map {
        height: 300px;
        border-radius: 10px;
        margin-top: 15px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<header class="page-header bg-gradient-primary text-white py-5 mb-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="fw-bold" data-aos="fade-right">Add New Property</h1>
                <nav aria-label="breadcrumb" data-aos="fade-right" data-aos-delay="100">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="{{ url_for('home') }}" class="text-white">Home</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('owner.dashboard') }}" class="text-white">Dashboard</a></li>
                        <li class="breadcrumb-item active text-white" aria-current="page">Add Property</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</header>

<!-- Add Property Section -->
<section class="py-5">
    <div class="container">
        <form action="{{ url_for('owner.add_property') }}" method="POST" enctype="multipart/form-data" id="addPropertyForm">
            <div class="row">
                <!-- Main Form Content -->
                <div class="col-lg-8">
                    <div class="property-form-card card mb-4" data-aos="fade-up">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Property Details</h5>
                            <span class="badge bg-primary">Step 1 of 4</span>
                        </div>
                        <div class="card-body">
                            <!-- Basic Information Section -->
                            <div class="form-section">
                                <h6 class="form-section-title">Basic Information</h6>
                                <div class="mb-3">
                                    <label for="title" class="form-label">Property Title*</label>
                                    <input type="text" class="form-control" id="title" name="title" required>
                                    <div class="form-text">A catchy title will attract more tenants</div>
                                </div>
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description*</label>
                                    <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
                                    <div class="form-text">Describe your property in detail (min. 100 characters)</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="property_type" class="form-label">Property Type*</label>
                                        <select class="form-select" id="property_type" name="property_type" required>
                                            <option value="" selected disabled>Select property type</option>
                                            <option value="apartment">Apartment</option>
                                            <option value="house">House</option>
                                            <option value="villa">Villa</option>
                                            <option value="condo">Condominium</option>
                                            <option value="studio">Studio</option>
                                            <option value="room">Room</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="furnishing" class="form-label">Furnishing Status</label>
                                        <select class="form-select" id="furnishing" name="furnishing">
                                            <option value="" selected disabled>Select furnishing status</option>
                                            <option value="fully_furnished">Fully Furnished</option>
                                            <option value="semi_furnished">Semi Furnished</option>
                                            <option value="unfurnished">Unfurnished</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Property Specifications Section -->
                            <div class="form-section">
                                <h6 class="form-section-title">Property Specifications</h6>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="bedrooms" class="form-label">Bedrooms*</label>
                                        <input type="number" class="form-control" id="bedrooms" name="bedrooms" min="0" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="bathrooms" class="form-label">Bathrooms*</label>
                                        <input type="number" class="form-control" id="bathrooms" name="bathrooms" min="0" step="0.5" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="area" class="form-label">Area (sq.ft)*</label>
                                        <input type="number" class="form-control" id="area" name="area" min="1" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="floor" class="form-label">Floor</label>
                                        <input type="number" class="form-control" id="floor" name="floor" min="0">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="total_floors" class="form-label">Total Floors</label>
                                        <input type="number" class="form-control" id="total_floors" name="total_floors" min="1">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="facing" class="form-label">Facing</label>
                                        <select class="form-select" id="facing" name="facing">
                                            <option value="" selected disabled>Select facing</option>
                                            <option value="north">North</option>
                                            <option value="south">South</option>
                                            <option value="east">East</option>
                                            <option value="west">West</option>
                                            <option value="north_east">North East</option>
                                            <option value="north_west">North West</option>
                                            <option value="south_east">South East</option>
                                            <option value="south_west">South West</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Amenities Section -->
                            <div class="form-section">
                                <h6 class="form-section-title">Amenities</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_parking" name="amenities[]" value="parking">
                                            <label class="form-check-label" for="amenity_parking">Parking</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_ac" name="amenities[]" value="ac">
                                            <label class="form-check-label" for="amenity_ac">Air Conditioning</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_gym" name="amenities[]" value="gym">
                                            <label class="form-check-label" for="amenity_gym">Gym</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_swimming_pool" name="amenities[]" value="swimming_pool">
                                            <label class="form-check-label" for="amenity_swimming_pool">Swimming Pool</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_lift" name="amenities[]" value="lift">
                                            <label class="form-check-label" for="amenity_lift">Lift/Elevator</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_security" name="amenities[]" value="security">
                                            <label class="form-check-label" for="amenity_security">Security</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_power_backup" name="amenities[]" value="power_backup">
                                            <label class="form-check-label" for="amenity_power_backup">Power Backup</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_wifi" name="amenities[]" value="wifi">
                                            <label class="form-check-label" for="amenity_wifi">WiFi</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_garden" name="amenities[]" value="garden">
                                            <label class="form-check-label" for="amenity_garden">Garden</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_balcony" name="amenities[]" value="balcony">
                                            <label class="form-check-label" for="amenity_balcony">Balcony</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_water_supply" name="amenities[]" value="water_supply">
                                            <label class="form-check-label" for="amenity_water_supply">24x7 Water Supply</label>
                                        </div>
                                        <div class="form-check amenity-checkbox">
                                            <input class="form-check-input" type="checkbox" id="amenity_clubhouse" name="amenities[]" value="clubhouse">
                                            <label class="form-check-label" for="amenity_clubhouse">Clubhouse</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Location Section -->
                            <div class="form-section">
                                <h6 class="form-section-title">Location</h6>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address*</label>
                                    <input type="text" class="form-control" id="address" name="address" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="city" class="form-label">City*</label>
                                        <input type="text" class="form-control" id="city" name="city" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="state" class="form-label">State*</label>
                                        <input type="text" class="form-control" id="state" name="state" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="pincode" class="form-label">Pincode*</label>
                                        <input type="text" class="form-control" id="pincode" name="pincode" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="locality" class="form-label">Locality/Area</label>
                                        <input type="text" class="form-control" id="locality" name="locality">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Map Location</label>
                                    <div id="locationMap" class="location-map"></div>
                                    <div class="form-text">Drag the marker to set the exact location of your property</div>
                                </div>
                                <input type="hidden" id="latitude" name="latitude">
                                <input type="hidden" id="longitude" name="longitude">
                            </div>
                            
                            <!-- Images Section -->
                            <div class="form-section">
                                <h6 class="form-section-title">Property Images</h6>
                                <div class="mb-3">
                                    <label for="property_images" class="form-label">Upload Images*</label>
                                    <input type="file" class="form-control" id="property_images" name="property_images[]" multiple accept="image/*" required>
                                    <div class="form-text">You can upload up to 10 images. Each image should be less than 5MB.</div>
                                </div>
                                <div class="image-preview-container" id="imagePreviewContainer">
                                    <div class="add-image-btn" id="addImageBtn">
                                        <i class="fas fa-plus"></i>
                                        <span>Add Image</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Pricing Card -->
                    <div class="property-form-card card mb-4" data-aos="fade-up" data-aos-delay="100">
                        <div class="card-header">
                            <h5 class="mb-0">Pricing & Availability</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="price" class="form-label">Rent (per month)*</label>
                                <div class="input-group">
                                    <span class="input-group-text">₹</span>
                                    <input type="number" class="form-control" id="price" name="price" min="1" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="security_deposit" class="form-label">Security Deposit</label>
                                <div class="input-group">
                                    <span class="input-group-text">₹</span>
                                    <input type="number" class="form-control" id="security_deposit" name="security_deposit" min="0">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="maintenance" class="form-label">Maintenance (per month)</label>
                                <div class="input-group">
                                    <span class="input-group-text">₹</span>
                                    <input type="number" class="form-control" id="maintenance" name="maintenance" min="0">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="available_from" class="form-label">Available From*</label>
                                <input type="date" class="form-control" id="available_from" name="available_from" required>
                            </div>
                            <div class="mb-3">
                                <label for="preferred_tenants" class="form-label">Preferred Tenants</label>
                                <select class="form-select" id="preferred_tenants" name="preferred_tenants">
                                    <option value="" selected>No preference</option>
                                    <option value="family">Family</option>
                                    <option value="bachelors">Bachelors</option>
                                    <option value="company">Company</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="lease_duration" class="form-label">Minimum Lease Duration</label>
                                <select class="form-select" id="lease_duration" name="lease_duration">
                                    <option value="" selected disabled>Select lease duration</option>
                                    <option value="3">3 months</option>
                                    <option value="6">6 months</option>
                                    <option value="12">1 year</option>
                                    <option value="24">2 years</option>
                                    <option value="36">3 years</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Card -->
                    <div class="property-form-card card mb-4" data-aos="fade-up" data-aos-delay="200">
                        <div class="card-header">
                            <h5 class="mb-0">Contact Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="contact_name" class="form-label">Contact Person*</label>
                                <input type="text" class="form-control" id="contact_name" name="contact_name" value="{{ current_user.name }}" required>
                            </div>
                            <div class="mb-3">
                                <label for="contact_email" class="form-label">Email*</label>
                                <input type="email" class="form-control" id="contact_email" name="contact_email" value="{{ current_user.email }}" required>
                            </div>
                            <div class="mb-3">
                                <label for="contact_phone" class="form-label">Phone*</label>
                                <input type="tel" class="form-control" id="contact_phone" name="contact_phone" value="{{ current_user.phone }}" required>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="show_contact_info" name="show_contact_info" checked>
                                <label class="form-check-label" for="show_contact_info">
                                    Show my contact information to interested tenants
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <div data-aos="fade-up" data-aos-delay="300">
                        <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">Add Property</button>
                        <button type="button" class="btn btn-outline-secondary w-100" id="saveAsDraftBtn">Save as Draft</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Image Preview Functionality
        const propertyImages = document.getElementById('property_images');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const addImageBtn = document.getElementById('addImageBtn');
        
        if (propertyImages && imagePreviewContainer && addImageBtn) {
            // Click on add image button triggers file input
            addImageBtn.addEventListener('click', function() {
                propertyImages.click();
            });
            
            // Handle file selection
            propertyImages.addEventListener('change', function() {
                // Clear existing previews except the add button
                const previews = imagePreviewContainer.querySelectorAll('.image-preview-item');
                previews.forEach(preview => preview.remove());
                
                // Add new previews
                for (let i = 0; i < this.files.length; i++) {
                    const file = this.files[i];
                    if (!file.type.startsWith('image/')) continue;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'image-preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Property Image">
                            <div class="remove-image">
                                <i class="fas fa-times"></i>
                            </div>
                        `;
                        
                        // Insert before the add button
                        imagePreviewContainer.insertBefore(previewItem, addImageBtn);
                        
                        // Handle remove button click
                        const removeBtn = previewItem.querySelector('.remove-image');
                        removeBtn.addEventListener('click', function() {
                            previewItem.remove();
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // Map Initialization (placeholder for Google Maps)
        const locationMap = document.getElementById('locationMap');
        if (locationMap) {
            // This would be replaced with actual Google Maps initialization
            locationMap.innerHTML = '<div class="d-flex align-items-center justify-content-center h-100 bg-light"><p class="text-muted mb-0">Map would be initialized here</p></div>';
        }
        
        // Save as Draft Button
        const saveAsDraftBtn = document.getElementById('saveAsDraftBtn');
        if (saveAsDraftBtn) {
            saveAsDraftBtn.addEventListener('click', function() {
                // Add a hidden input to indicate draft status
                const draftInput = document.createElement('input');
                draftInput.type = 'hidden';
                draftInput.name = 'is_draft';
                draftInput.value = 'true';
                document.getElementById('addPropertyForm').appendChild(draftInput);
                
                // Submit the form
                document.getElementById('addPropertyForm').submit();
            });
        }
    });
</script>
{% endblock %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3">
        <div class="container">
            <p>&copy; 2025 HRP. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../js/script.js"></script>
</body>
</html>
